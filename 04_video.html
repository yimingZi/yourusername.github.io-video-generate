<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人工智能视频生成</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .spinner {
            border-top-color: transparent;
            width: 1rem;
            height: 1rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen">
    <div class="container mx-auto max-w-2xl w-full p-4">
        <!-- 页头 -->
        <header class="text-center mb-8">
            <span class="inline-block bg-emerald-100 text-emerald-800 text-xs font-semibold px-2.5 py-0.5 rounded-full mb-2">Automation Video</span>
            <h1 class="text-3xl font-bold text-gray-900">生成视频</h1>
            <p class="text-gray-600 mt-2">上传一张图片，描述您的需求，即可生成一段精彩的 UGC 风格广告视频。</p>
        </header>

        <!-- 警告框 (默认隐藏) -->
        <div id="alertBox" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6" role="alert">
            <strong class="font-bold">错误！</strong>
            <span class="block sm:inline" id="alertMessage"></span>
            <span class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="document.getElementById('alertBox').classList.add('hidden')">
                <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>关闭</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
            </span>
        </div>

        <main class="bg-white p-8 rounded-lg shadow-md">
            <!-- 输入区域 -->
            <div class="space-y-6">
                <div>
                    <label for="imageUrl" class="block text-sm font-medium text-gray-700">图像 URL</label>
                    <input type="url" name="imageUrl" id="imageUrl" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" placeholder="https://example.com/image.png">
                </div>
                <div id="previewContainer" class="hidden text-center">
                    <label class="block text-sm font-medium text-gray-700 mb-2">图像预览</label>
                    <canvas id="imageCanvas" class="mx-auto border border-gray-200 rounded-md"></canvas>
                </div>
                <div>
                    <label for="prompt" class="block text-sm font-medium text-gray-700">描述 UGC 广告</label>
                    <textarea id="prompt" name="prompt" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" placeholder="例如：一个年轻女性在阳光明媚的厨房里，开心地品尝一杯燕麦拿铁。"></textarea>
                </div>
                <div>
                    <label for="scripts" class="block text-sm font-medium text-gray-700">脚本内容</label>
                    <textarea id="scripts" name="scripts" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" placeholder="旁白或人物对话，请按行分隔。&#10;“全新活力燕麦拿铁，开启你的一天！”&#10;“每一口都是阳光的味道。”"></textarea>
                </div>
                <div>
                    <label for="character" class="block text-sm font-medium text-gray-700">说话的人物</label>
                    <textarea id="character" name="character" rows="2" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" placeholder="例如：25岁，女性，穿着白色休闲T恤。"></textarea>
                </div>
            </div>

            <!-- 操作区域 -->
            <div class="mt-8">
                <button id="generateBtn" type="button" class="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:bg-gray-400 disabled:cursor-not-allowed">
                    <span id="btnText">生成视频</span>
                    <div id="spinner" class="hidden spinner ml-3 border-2 border-white rounded-full"></div>
                </button>
            </div>

            <!-- 结果展示 -->
            <div id="resultSection" class="mt-8 text-center relative">
                <div id="resultOverlay" class="hidden absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-lg">
                    <div class="text-center">
                        <div class="spinner border-4 border-emerald-500 rounded-full w-12 h-12 mx-auto"></div>
                        <p class="mt-4 text-gray-600">视频生成中，请稍候...</p>
                    </div>
                </div>
                <div id="resultPlaceholder" class="text-gray-500 py-10 border-2 border-dashed border-gray-300 rounded-lg">
                    <p>生成的视频将显示在此处</p>
                </div>
                <!-- 新的视频容器，用于存放所有生成的视频 -->
                <div id="videoContainer" class="space-y-4"></div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageUrlInput = document.getElementById('imageUrl');
            const promptInput = document.getElementById('prompt');
            const scriptsInput = document.getElementById('scripts');
            const characterInput = document.getElementById('character');
            const generateBtn = document.getElementById('generateBtn');
            const previewContainer = document.getElementById('previewContainer');
            const imageCanvas = document.getElementById('imageCanvas');
            const ctx = imageCanvas.getContext('2d');
            const alertBox = document.getElementById('alertBox');
            const alertMessage = document.getElementById('alertMessage');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            const resultSection = document.getElementById('resultSection');
            const resultPlaceholder = document.getElementById('resultPlaceholder');
            const resultOverlay = document.getElementById('resultOverlay');

            const webhookUrl = 'http://localhost:5678/webhook/7fe35d51-e292-47d9-9800-93d7f5b46f3d'; 

            const checkInputs = () => {
                const isImageUrlValid = isValidUrl(imageUrlInput.value);
                const areTextInputsFilled = promptInput.value.trim() !== '' && scriptsInput.value.trim() !== '' && characterInput.value.trim() !== '';
                generateBtn.disabled = !(isImageUrlValid && areTextInputsFilled);
            };

            const isValidUrl = (string) => {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            };

            const showError = (message) => {
                alertMessage.textContent = message;
                alertBox.classList.remove('hidden');
            };

            const handleImage = () => {
                const url = imageUrlInput.value;
                if (!isValidUrl(url)) {
                    previewContainer.classList.add('hidden');
                    return;
                }
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = () => {
                    const maxWidth = previewContainer.parentElement.clientWidth;
                    const scale = Math.min(1, maxWidth / img.width);
                    imageCanvas.width = img.width * scale;
                    imageCanvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, imageCanvas.width, imageCanvas.height);
                    previewContainer.classList.remove('hidden');
                };
                img.onerror = () => {
                    showError('无法加载图像。请检查 URL 是否正确或图像是否支持跨域访问。');
                    previewContainer.classList.add('hidden');
                };
                img.src = url;
            };

            [imageUrlInput, promptInput, scriptsInput, characterInput].forEach(input => {
                input.addEventListener('input', checkInputs);
            });
            imageUrlInput.addEventListener('change', handleImage);

            generateBtn.addEventListener('click', async () => {
                const videoContainer = document.getElementById('videoContainer');

                btnText.textContent = '生成中...';
                spinner.classList.remove('hidden');
                generateBtn.disabled = true;
                resultOverlay.classList.remove('hidden');
                resultPlaceholder.classList.remove('hidden');
                videoContainer.innerHTML = '';
                alertBox.classList.add('hidden');

                try {
                    const formData = new FormData();
                    formData.append('prompt', promptInput.value.trim());
                    formData.append('Scripts', scriptsInput.value.trim());
                    formData.append('Character', characterInput.value.trim());
                    formData.append('image', imageUrlInput.value.trim());

                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`网络响应错误，状态码: ${response.status}`);
                    }

                    const videoUrls = await response.json();
                    if (!Array.isArray(videoUrls) || videoUrls.length === 0) {
                        throw new Error('收到的响应不是有效的视频链接列表。');
                    }
                    
                    videoUrls.forEach(videoUrl => {
                        const videoElement = document.createElement('video');
                        videoElement.src = videoUrl;
                        videoElement.controls = true;
                        videoElement.className = 'w-full rounded-lg';
                        videoContainer.appendChild(videoElement);
});
                    
                    resultPlaceholder.classList.add('hidden');

                } catch (error) {
                    console.error('生成视频时出错:', error);
                    showError(error.message || '发生未知错误，请检查控制台获取更多信息。');
                    resultPlaceholder.classList.remove('hidden');
                    videoContainer.innerHTML = '';
                } finally {
                    btnText.textContent = '生成视频';
                    spinner.classList.add('hidden');
                    checkInputs();
                    resultOverlay.classList.add('hidden');
                }
            });
            checkInputs();
        });
    </script>
</body>
</html>```